<h1>Available Licenses</h1>
<p class="page-description">Select a license to assign it to yourself.</p>

<% if @available_assignments && !@available_assignments.empty? %>
  <div class="cards-container">
    <% @available_assignments.each do |assignment| %>
      <div class="card license-card-available">
        <h2><%= Rack::Utils.escape_html("#{assignment.license.product.product_name}: #{assignment.license.license_name}") %></h2>

        <p><strong>Seats Available:</strong> <%= assignment.license.available_seats %></p>

        <% if assignment.license.notes && !assignment.license.notes.strip.empty? %>
          <p class="license-notes"><strong>Notes:</strong> <%= Rack::Utils.escape_html(assignment.license.notes) %></p>
        <% end %>

        <button class="button-primary" onclick="showAssignPopup('<%= assignment.assignment_id %>', '<%= Rack::Utils.escape_html(assignment.license.product.product_name || assignment.license.license_name || "Unnamed License") %>')">
          Assign to Me
        </button>

      </div>
    <% end %>
  </div>
<% else %>
  <p class="no-licenses-message">No licenses are currently available for self-assignment.</p>
<% end %>

<div class="popup" id="assignLicensePopup">
  <div class="popup-content">
    <h3 id="popupAssignTitle">Assign License</h3>
    <p>Are you sure you want to assign the license for <strong id="popupAssignProductName">Product Name Here</strong> to yourself?</p>
    <form id="assignForm" method="post" action="">
      <div class="button-group">
        <button type="submit" class="button-primary">Yes, Assign</button>
        <button type="button" class="button-secondary" onclick="hideAssignPopup()">Cancel</button>
      </div>
    </form>
  </div>
</div>

<script>
    function showAssignPopup(licenseId, productName) {
        const productNameElement = document.getElementById("popupAssignProductName");
        if (productNameElement) {
            productNameElement.textContent = productName;
        }

        const assignForm = document.getElementById("assignForm");
        if (assignForm) {
            // Hier muss die URL angepasst werden, wenn sich der Endpunkt ge√§ndert hat
            assignForm.action = `/licenses/${licenseId}/activate`;
            // Alternativ, falls der Endpunkt immer noch auf licenses verweist:
            // assignForm.action = `/licenses/${licenseId}/activate`;
        }

        const assignPopup = document.getElementById("assignLicensePopup");
        if (assignPopup) {
            assignPopup.style.display = "flex";
        }
    }

    function hideAssignPopup() {
        const assignPopup = document.getElementById("assignLicensePopup");
        if (assignPopup) {
            assignPopup.style.display = "none";
        }
    }

</script>
