<% @title = "License Management" %>
<% @css   = "license_management" %>

<div class="license-management-container">
  <div class="toolbar">
    <div class="search-box">
      <input type="text" id="search-input" placeholder="Search License…">
      <button id="search-btn" aria-label="Search">🔍</button>
      <button id="add-license-btn" class="add-btn" title="Add new License">＋</button>
    </div>
  </div>

  <ul class="license-list">
    <% @licenses.each do |license| %>
      <li class="license-item"
          data-license_id="<%= license.id %>"
          data-license_key="<%= license.license_key %>"
          data-seat_count="<%= license.seat_count %>"
          data-product_name="<%= license.product.product_name %>"
          data-license_type="<%= license.license_type.type_name %>">
        <span class="license-name">
          <%= license.product.product_name %> - <%= license.license_key %>
        </span>
      </li>
    <% end %>
  </ul>
</div>

<!-- Modal nur für Datenanzeige -->
<div id="license-modal" class="modal hidden">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h2 id="modal-title">License Details</h2>
    <form id="license-form">
      <label>License Key:</label>
      <input type="text" name="license_key" readonly>

      <label>Seat Count:</label>
      <input type="number" name="seat_count" readonly>

      <label>Product:</label>
      <input type="text" name="product_name" readonly>

      <label>License Type:</label>
      <input type="text" name="license_type" readonly>
    </form>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const items = document.querySelectorAll(".license-item");
  const modal = document.getElementById("license-modal");
  const closeBtn = modal.querySelector(".close-btn");
  const form = document.getElementById("license-form");

  function openModal(data = {}) {
    form.license_key.value = data.license_key || '';
    form.seat_count.value = data.seat_count || '';
    form.product_name.value = data.product_name || '';
    form.license_type.value = data.license_type || '';

    modal.classList.remove("hidden");
  }

  items.forEach(item =>
    item.addEventListener("click", () => openModal(item.dataset))
  );

  closeBtn.addEventListener("click", () =>
    modal.classList.add("hidden")
  );
});
</script>
